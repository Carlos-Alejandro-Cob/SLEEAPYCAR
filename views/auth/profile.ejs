<%- include('../layouts/header', { ...locals, title: 'Mi Perfil - SLEE APYCAR' }) %>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h2 class="mb-4">Mi Perfil</h2>

                <% if (locals.success_msg && locals.success_msg.length> 0) { %>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <%= success_msg %>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    <% } %>

                        <% if (locals.error_msg && locals.error_msg.length> 0) { %>
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                <%= error_msg %>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"
                                        aria-label="Close"></button>
                            </div>
                            <% } %>

                                <!-- User Info Card -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header" style="background-color: var(--primary-green); color: var(--white);">
                                        <h5 class="mb-0"><i class="fas fa-user-circle me-2"></i>Información Personal
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-sm-4 fw-bold">Nombre Completo:</div>
                                            <div class="col-sm-8">
                                                <%= user.nombre_completo %>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-4 fw-bold">Usuario:</div>
                                            <div class="col-sm-8">
                                                <%= user.nombre_usuario %>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-4 fw-bold">Email:</div>
                                            <div class="col-sm-8">
                                                <%= user.email %>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <!-- Change Password Card -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0"><i class="fas fa-key me-2" style="color: var(--primary-green);"></i>Cambiar Contraseña</h5>
                                    </div>
                                    <div class="card-body">
                                        <form action="/auth/profile/change-password" method="POST">
                                            <div class="mb-3">
                                                <label for="current_password" class="form-label">Contraseña
                                                    Actual</label>
                                                <input type="password" class="form-control" id="current_password"
                                                    name="current_password" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="new_password" class="form-label">Nueva Contraseña</label>
                                                <input type="password" class="form-control" id="new_password"
                                                    name="new_password" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="confirm_password" class="form-label">Confirmar Nueva
                                                    Contraseña</label>
                                                <input type="password" class="form-control" id="confirm_password"
                                                    name="confirm_password" required>
                                            </div>
                                            <button type="submit" class="btn btn-success">Actualizar Contraseña</button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Delete Account Card -->
                                <div class="card shadow-sm border-danger">
                                    <div class="card-header bg-danger text-white">
                                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Zona de Peligro
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted">Una vez que elimines tu cuenta, no hay vuelta atrás. Por
                                            favor, asegúrate.</p>
                                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                                            data-bs-target="#deleteAccountModal">
                                            Eliminar Mi Cuenta
                                        </button>
                                    </div>
                                </div>
            </div>
        </div>
    </div>

    <!-- Modal Header -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteAccountModalLabel">¿Estás seguro?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Estás a punto de eliminar tu cuenta permantentemente. Esta acción <strong>no se puede
                            deshacer</strong>.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form action="/auth/profile/delete" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger">Sí, eliminar mi cuenta</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <%- include('../layouts/footer') %>