<%- include('../layouts/header', { ...locals, title: (isEdit ? 'Editar Envío' : 'Nuevo Envío') + ' - SLEE APYCAR' }) %>

<div class="row justify-content-center">
    <div class="col-md-8">
        <!-- Header Section -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">
                    <i class="fas <%= isEdit ? 'fa-edit' : 'fa-plus-circle' %> me-2 text-primary"></i>
                    <%= isEdit ? 'Editar Envío' : 'Nuevo Envío' %>
                </h1>
                <p class="text-muted">
                    <%= isEdit ? 'Modifica los detalles del envío.' : 'Completa el formulario para registrar un nuevo envío.' %>
                </p>
            </div>
            <a href="/admin/envios" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>
                Volver a la lista
            </a>
        </div>

        <!-- Form Card -->
        <div class="card">
            <div class="card-body">
                <form action="<%= isEdit ? '/admin/envios/' + envio._id + '?_method=PUT' : '/admin/envios' %>" method="POST">
                    <!-- Ya no se necesita el input oculto, se usa el query param en el action -->
                    
                    <div class="mb-3">
                        <label for="ID_Envio" class="form-label">ID de Envío</label>
                        <input type="text" class="form-control" id="ID_Envio" name="ID_Envio" value="<%= envio ? envio.ID_Envio : '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="Nombre_Destinatario" class="form-label">Nombre del Destinatario</label>
                        <input type="text" class="form-control" id="Nombre_Destinatario" name="Nombre_Destinatario" value="<%= envio ? envio.Nombre_Destinatario : '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="Direccion_Completa" class="form-label">Dirección Completa</label>
                        <input type="text" class="form-control" id="Direccion_Completa" name="Direccion_Completa" value="<%= envio ? envio.Direccion_Completa : '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="Estado_Envio" class="form-label">Estado del Envío</label>
                        <select class="form-select" id="Estado_Envio" name="Estado_Envio">
                            <option value="Pendiente" <%= (envio && envio.Estado_Envio === 'Pendiente') ? 'selected' : '' %>>Pendiente</option>
                            <option value="En Ruta" <%= (envio && envio.Estado_Envio === 'En Ruta') ? 'selected' : '' %>>En Ruta</option>
                            <option value="Entregado" <%= (envio && envio.Estado_Envio === 'Entregado') ? 'selected' : '' %>>Entregado</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="URL_Foto_Entrega" class="form-label">URL de Foto de Entrega (Opcional)</label>
                        <input type="url" class="form-control" id="URL_Foto_Entrega" name="URL_Foto_Entrega" value="<%= envio ? (envio.URL_Foto_Entrega || '') : '' %>" placeholder="https://...">
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <a href="/admin/envios" class="btn btn-secondary me-2">Cancelar</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            <%= isEdit ? 'Actualizar Envío' : 'Guardar Envío' %>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<%- include('../layouts/footer') %>

<script>
// Puedes añadir aquí validaciones de JavaScript del lado del cliente si lo necesitas.
document.querySelector('form').addEventListener('submit', function(e) {
    const idEnvio = document.getElementById('ID_Envio').value;
    if (!idEnvio) {
        alert('El ID de Envío es obligatorio.');
        e.preventDefault();
    }
    // Agrega más validaciones según sea necesario...
});
</script>